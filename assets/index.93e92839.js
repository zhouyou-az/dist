import{M as e,_ as a}from"./DialogComponent.234733d9.js";import{d as l,r as t,n as o,e as n,o as d,f as r,k as i,g as u,b as m,w as s,F as p,l as c,i as h}from"./index.20cbabfe.js";import{S as f,D as g}from"./http.248f93ba.js";import"./vendor.196df497.js";var b=l({name:"MenuTree",components:{},props:{selectedKey:{type:Number,default:0}},emits:[],setup:e=>({treeRef:t()}),data:()=>({defaultProps:{children:"children",label:"name"},tree:[]}),computed:{},methods:{checkboxClick(e,{checkedKeys:a}){this.singleChecked(e)},nodeClick(e,a,l){this.treeRef.setChecked(e.id,!a.checked,!1),this.singleChecked(e)},singleChecked(e){this.treeRef.getCheckedKeys().forEach((a=>{e.id!=a&&this.treeRef.setChecked(a,!1,!1)}))},loadMenuTree(){e.queryTree().then((e=>{const a=[{name:"主目录",children:[],id:0}];a[0].children=e.data,this.tree=a,o((()=>{this.treeRef.setChecked(this.selectedKey,!0,!1)}))}))},getTree(){return this.treeRef}},created(){this.loadMenuTree()}});const V=i("data-v-08500580")(((e,a,l,t,o,i)=>{const u=n("el-tree");return d(),r(u,{data:e.tree,"show-checkbox":"","default-expand-all":"","node-key":"id",ref:"treeRef","highlight-current":"",props:e.defaultProps,"check-strictly":!0,onCheck:e.checkboxClick,onNodeClick:e.nodeClick,"expand-on-click-node":!1},null,8,["data","props","onCheck","onNodeClick"])}));b.render=V,b.__scopeId="data-v-08500580";var F=l({name:"MenuTreeDialog",components:{DialogComponent:a,MenuTree:b},props:{modelValue:{type:Boolean,default:!1},selectedKey:{type:Number,default:0}},emits:["update:modelValue","save"],setup:e=>({dialogRef:t(),menuTreeRef:t()}),data:()=>({}),computed:{},watch:{},methods:{selectedMenu(){const e=this.menuTreeRef.getTree(),a=e.getCheckedKeys(),l=e.getNode(a[0]);this.$emit("update:modelValue",!1),this.$emit("save",l.data)},open(){this.dialogRef.open(...arguments)}}});const k=i("data-v-5a82ed8c"),M=k(((e,a,l,t,o,i)=>{const m=n("menu-tree"),s=n("dialog-component");return d(),r(s,{modelValue:e.modelValue,"onUpdate:modelValue":a[1]||(a[1]=a=>e.$emit("update:modelValue",a)),width:"300px",onSave:e.selectedMenu,ref:"dialogRef"},{default:k((()=>[u(m,{ref:"menuTreeRef",selectedKey:e.selectedKey},null,8,["selectedKey"])])),_:1},8,["modelValue","onSave"])}));F.render=M,F.__scopeId="data-v-5a82ed8c";var C=l({name:"MenuComponent",components:{DialogComponent:a,MenuTreeDialog:F},props:{},emits:[],setup(e){const a=t(),l=t(),o=t(),n=t();return{dialogRef:a,menuForm:m({code:"",name:"",parentName:"主目录",parentId:null}),menuFormValidation:{code:[{required:!0,message:"请填写code",trigger:"blur"}],name:[{required:!0,message:"请填写菜单名称",trigger:"blur"}]},menuDialogRef:l,parentNameInputRef:o,menuFormRef:n}},data:()=>({tableHeader:[{label:"菜单名称",prop:"name"},{label:"排序",prop:"sortOrder"},{label:"请求地址",prop:"url"},{label:"类型",prop:"type"},{label:"权限标识",prop:"code"}],dialogVisible:!1,menudialogVisible:!1,menuList:[],menuMap:new Map,searchFrom:{search:""}}),computed:{},watch:{},methods:{createMenuDialog(e){this.menuFormRef&&this.menuFormRef.resetFields(),this.menuForm.parentId=e.id?e.id:null,this.menuForm.parentName=e.name,this.dialogRef.open(m({title:"新增菜单",handler:this.createMenu,validate:this.menuFormRef}))},updateMenuDialog(e){let a=this.menuMap.get(e.parentId);a||(a={id:0,name:"主目录"}),Object.assign(this.menuForm,e),this.menuForm.parentId=a.id?a.id:null,this.menuForm.parentName=a.name,this.dialogRef.open(m({title:"编辑菜单",handler:this.updateMneu,validate:this.menuFormRef}))},loadMenuList(){e.queryList(this.searchFrom).then((e=>{this.menuList=e.data,this.menuMap=this.menuList.reduce(((e,a)=>(e.set(a.id,a),e)),new Map)}))},createMenu(){e.create(this.menuForm).then((e=>{e.success&&(f("新增菜单成功"),this.loadMenuList(),this.dialogVisible=!1)}))},updateMneu(){e.update(this.menuForm).then((e=>{e.success&&(f("编辑菜单成功"),this.loadMenuList(),this.dialogVisible=!1)}))},removeMenu(a){g().then((()=>{e.remove(a).then((e=>{e.success&&(f("删除菜单成功"),this.loadMenuList(),this.dialogVisible=!1)}))}))}},created(){this.loadMenuList()}});const R={class:"column-start-center"},y={style:{height:"60px","margin-bottom":"20px"},class:"white-box light-shadow row-start-center"},_=h("查询"),v={class:"white-box light-shadow",style:{height:"calc(100% - 80px)"}},w={class:"opreate-row"},x=h("新增"),D=h("编辑"),I=h("新增"),N=h("删除"),T=h("选择");C.render=function(e,a,l,t,o,i){const m=n("el-input"),h=n("el-button"),f=n("el-table-column"),g=n("el-table"),b=n("el-form-item"),V=n("el-form"),F=n("dialog-component"),k=n("menu-tree-dialog");return d(),r("div",R,[u("div",y,[u(m,{modelValue:e.searchFrom.search,"onUpdate:modelValue":a[1]||(a[1]=a=>e.searchFrom.search=a),style:{width:"200px","margin-right":"10px"},placeholder:"菜单名称关键字"},null,8,["modelValue"]),u(h,{onClick:e.loadMenuList},{default:s((()=>[_])),_:1},8,["onClick"])]),u("div",v,[u("div",w,[u(h,{icon:"el-icon-plus",type:"primary",onClick:a[2]||(a[2]=a=>e.createMenuDialog({name:"主目录",id:0,code:""}))},{default:s((()=>[x])),_:1})]),u(g,{data:e.menuList,"row-key":"id","highlight-current-row":""},{default:s((()=>[(d(!0),r(p,null,c(e.tableHeader,(e=>(d(),r(f,{key:e.prop,label:e.label,prop:e.prop},null,8,["label","prop"])))),128)),u(f,{label:"操作"},{default:s((a=>[u(h,{onClick:l=>e.updateMenuDialog(a.row)},{default:s((()=>[D])),_:2},1032,["onClick"]),u(h,{onClick:l=>e.createMenuDialog(a.row)},{default:s((()=>[I])),_:2},1032,["onClick"]),u(h,{onClick:l=>e.removeMenu(a.row.id)},{default:s((()=>[N])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),u(F,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[10]||(a[10]=a=>e.dialogVisible=a),ref:"dialogRef"},{default:s((()=>[u(V,{model:e.menuForm,rules:e.menuFormValidation,ref:"menuFormRef","label-width":"80px"},{default:s((()=>[u(b,{label:"上级菜单"},{default:s((()=>[u(m,{modelValue:e.menuForm.parentName,"onUpdate:modelValue":a[4]||(a[4]=a=>e.menuForm.parentName=a),readonly:"",onFocus:a[5]||(a[5]=a=>{e.menuDialogRef.open({title:"菜单选择"}),e.parentNameInputRef.blur()}),ref:"parentNameInputRef"},{append:s((()=>[u(h,{onClick:a[3]||(a[3]=a=>{e.menuDialogRef.open({title:"菜单选择"})})},{default:s((()=>[T])),_:1})])),_:1},8,["modelValue"]),u(m,{modelValue:e.menuForm.parentId,"onUpdate:modelValue":a[6]||(a[6]=a=>e.menuForm.parentId=a),style:{display:"none"}},null,8,["modelValue"])])),_:1}),u(b,{label:"菜单标识",prop:"code"},{default:s((()=>[u(m,{modelValue:e.menuForm.code,"onUpdate:modelValue":a[7]||(a[7]=a=>e.menuForm.code=a)},null,8,["modelValue"])])),_:1}),u(b,{label:"菜单名称",prop:"name"},{default:s((()=>[u(m,{modelValue:e.menuForm.name,"onUpdate:modelValue":a[8]||(a[8]=a=>e.menuForm.name=a)},null,8,["modelValue"])])),_:1}),u(b,{label:"请求路径",prop:"url"},{default:s((()=>[u(m,{modelValue:e.menuForm.url,"onUpdate:modelValue":a[9]||(a[9]=a=>e.menuForm.url=a)},null,8,["modelValue"])])),_:1}),u(b,{label:"图标",prop:"iconClass"},{default:s((()=>[u(m)])),_:1}),u(b,{label:"菜单排序",prop:"sortOrder"},{default:s((()=>[u(m)])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),u(k,{modelValue:e.menudialogVisible,"onUpdate:modelValue":a[11]||(a[11]=a=>e.menudialogVisible=a),ref:"menuDialogRef",onSave:a[12]||(a[12]=a=>{e.menuForm.parentName=a.name,e.menuForm.parentId=a.id?a.id:null}),selectedKey:e.menuForm.parentId?e.menuForm.parentId:0},null,8,["modelValue","selectedKey"])])])};export default C;
